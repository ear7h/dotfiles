#!/usr/bin/env node

const fs = require('fs');
const child_process = require('child_process');
const process = require('process');
const argv = require('process').argv;

const exe = () => {
	let p = child_process.spawn(argv[3], argv.slice(4));

	p.stdout.on('data', (data) => {
		process.stdout.write(data);
	});

	p.stderr.on('data', (data) => {
		process.stderr.write(data);
	});
}

let watcher = fs.watch(argv[2], (evt) => {
	if (evt === 'rename') {
		watcher.close();
	} else {
		exe();
	}
});

watcher.on('close', (_) => {
	watcher = fs.watch(argv[2]);
});
